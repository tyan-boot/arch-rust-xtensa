# Maintainer: Your Name <youremail@domain.com>

pkgname=rust-xtensa-git
pkgver=r142753.9b05fc7
pkgrel=1
pkgdesc="Rust for ESP Xtensa"
arch=('x86_64')
url="https://github.com/MabezDev/rust-xtensa"
license=('GPL')
makedepends=('git' 'cmake' 'ninja' 'llvm-xtensa')
provides=('rust-xtensa')
source=(
  'git+https://github.com/MabezDev/rust-xtensa#commit=9b05fc765f61af097eb53a23670830ba4c7fcea3'
)
sha256sums=('SKIP')

prepare() {
  cd ${srcdir}/rust-xtensa
}

build() {
  cd ${srcdir}/rust-xtensa
  ./configure \
  --prefix=/opt/rust-xtensa \
  --sysconfdir=/opt/rust-xtensa/etc \
  --experimental-targets=Xtensa \
  --enable-optimize \
  --enable-extended \
  --enable-profiler \
  --enable-sanitizers \
  --disable-docs \
  --tools cargo,clippy,rustfmt,src

  mkdir -p ${srcdir}/dest-rust
  DESTDIR=${srcdir}/dest-rust python x.py install -i
}

package() {
  cp -a ${srcdir}/dest-rust/* "$pkgdir"
}
