# Maintainer: Tyan Boot <tyan-boot@outlook.com>

pkgname=rust-xtensa-git
pkgver=r208923.84ecb3f
pkgrel=1
pkgdesc="Rust for ESP Xtensa"
arch=('x86_64')
url="https://github.com/esp-rs/rust"
license=('GPL')
makedepends=('git' 'cmake' 'ninja' 'python')
provides=('rust-xtensa')
source=(
  'git+https://github.com/esp-rs/rust#commit=84ecb3f010525cb1b2e7d4da306099c2eaa3e6cd'
)
sha256sums=('SKIP')

build() {
  cd ${srcdir}/rust
  ./configure \
  --prefix=/opt/rust-xtensa \
  --sysconfdir=/opt/rust-xtensa/etc \
  --experimental-targets=Xtensa \
  --enable-extended \
  --enable-profiler \
  --enable-sanitizers \
  --disable-docs \
  --tools cargo,clippy,rustfmt,src

  mkdir -p ${srcdir}/dest-rust
  DESTDIR=${srcdir}/dest-rust python x.py install -i
}

package() {
  cp -a ${srcdir}/dest-rust/* "$pkgdir"
}
